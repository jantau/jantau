"0","# Erstelle matrizen"
"0","matrix <- data.frame(matrix(NA, nrow = years_save*12*3, ncol = length(years)-years_save+1))"
"0","matrix_2 <- data.frame(matrix(NA, nrow = years_save*12*3, ncol = length(years)-years_save+1))"
"0","matrix_3 <- data.frame(matrix(NA, nrow = years_save*12*3, ncol = 1))"
"0",""
"0","for (i in years) {"
"0","  "
"0","  p <- dax_1 %>%"
"0","    group_by(symbol) %>%"
"0","    filter(year >= i  & year <= i+years_save-1) %>%"
"0","    mutate(anteil = monthly_rate/adjusted) %>%"
"0","    mutate(anteil_cumsum = cumsum(anteil)) %>%"
"0","    mutate(wert = anteil_cumsum*adjusted) %>%"
"0","    mutate(ansparen = monthly_rate) %>%"
"0","    mutate(ansparen_cumsum = cumsum(ansparen))"
"0","  "
"0","  if (nrow(p) < years_save*12*3) next"
"0","  "
"0","    matrix[,i-i_date] <- p[,9]"
"0","    matrix_2[,i-i_date] <- p[,2]"
"0","    matrix_3 <- p[,1]"
"0","}"
"0",""
"0","pal <- got(3, option = ""Daenerys"", direction = -1)"
"0",""
"0","for (i in years) {"
"0","  p <- dax_1 %>%"
"0","    group_by(symbol) %>%"
"0","    filter(year >= i  & year <= i + years_save - 1) %>%"
"0","    mutate(anteil = monthly_rate / adjusted) %>%"
"0","    mutate(anteil_cumsum = cumsum(anteil)) %>%"
"0","    mutate(wert = anteil_cumsum * adjusted) %>%"
"0","    mutate(ansparen = monthly_rate) %>%"
"0","    mutate(ansparen_cumsum = cumsum(ansparen))"
"0","  "
"0","  if (nrow(p) < years_save * 12 * 3)"
"0","    next"
"0","  "
"0","  y <- ggplot(p) +"
"0","    "
"0","    #   geom_line(aes(x = date, y = ansparen_cumsum), color = ""black"", alpha = 1)+"
"0","    "
"0","    #   geom_ribbon(aes(x = date, ymax = wert, ymin = 0, fill = symbol),  alpha = .5)+"
"0","    "
"0","    geom_line(aes(x = date, y = wert, color = symbol),"
"0","              alpha = 1,"
"0","              size = 1) +"
"0","    #  scale_x_date(expand=c(0.1, 0)) +"
"0","    "
"0","    #  geom_dl(aes(label = last(wert),  x = date, y = wert, color = symbol), method = list(dl.trans(x = x + .2), ""last.points"")) +"
"0","    "
"0","    #    geom_vline(aes(xintercept = as.Date(""2002-10-07"")), size = 0.5)+"
"0","    #    geom_text(aes(x = as.Date(""2002-10-07"")+400, y = max(matrix), label = ""DotCom Low\n7. Okt. 2002""), size = 3)+"
"0","    #    geom_vline(aes(xintercept=as.Date(""2009-03-09"")), size = 0.5)+"
"0","    #    geom_text(aes(x = as.Date(""2009-03-09"")+400, y = max(matrix), label = ""Finanzkrise\n9. Mrz. 2009""), size = 3)+"
"0","    "
"0","    #    geom_dl(aes(label = symbol, x = date, y=wert), method = list(dl.trans(x = x + 0.2), ""last.points"", cex = 0.8)) +"
"0","    "
"0","  #    geom_dl(aes(label = round(last(wert), 0), x = date, y = wert, color = symbol), method = list(""last.qp""))+"
"0","  "
"0","  geom_ribbon(aes("
"0","    x = date,"
"0","    ymin = 0,"
"0","    ymax = ansparen_cumsum,"
"0","    fill = ""Ansparen"""
"0","  ),"
"0","  alpha = .5) +"
"0","    "
"0","    #    geom_dl(aes(label = round(last(ansparen_cumsum), 0), x = date, y = ansparen_cumsum), method = ""last.qp"", color = ""black"", alpha = .3)+"
"0","    "
"0","    theme_jantau +"
"0","    labs("
"0","      title = paste0(""Entwicklung von "", i, "" bis "", i + years_save - 1),"
"0","      x = """","
"0","      y = """","
"0","      color = """","
"0","      fill = """","
"0","      subtitle = ""Datenquelle: finance.yahoo.com; Datenanalyse: jantau"""
"0","    ) +"
"0","    scale_y_continuous(limits = c(0, max(matrix)),"
"0","                       labels = dollar_format(suffix = "" â‚¬"", prefix = """")) +"
"0","    scale_color_manual(values = pal) +"
"0","    scale_fill_manual(values = ""grey"") +"
"0","    #  scale_color_manual(values=c(pal[1], pal[70], pal[128]))+"
"0","    # scale_fill_manual(values=c(pal[1], pal[70], pal[128]))+"
"0","    #  scale_fill_got(discrete = F, option = ""Martell"") +"
"0","    # scale_color_got(discrete = F, option = ""Martell"") +"
"0","    theme("
"0","      panel.grid.major.y = element_line(colour = ""grey"", linetype = ""dashed""),"
"0","      legend.position = ""bottom"" ,"
"0","      # c(0.3, 0.7)"
"0","      legend.direction = ""horizontal"""
"0","    )"
"0","  "
"0","  fp <- file.path(ansparen_dir_out, paste0(i, "".png""))"
"0","  "
"0","  ggsave("
"0","    plot = y,"
"0","    filename = fp,"
"0","    device = ""png"","
"0","    width = 20,"
"0","    height = 16,"
"0","    units = ""cm"""
"0","  )"
"0","  "
"0","  "
"0","  #  print(y)"
"0","}  "
