"0",""
"0",""
"0","  # Find all-time highs"
"0","  for (i in 1:nrow(sp500)){"
"0","    if(sp500[i, ""adjusted""] < max(sp500[1:i, ""adjusted""])){"
"0","      sp500[i, ""ath""] <- 0"
"0","    } else{"
"0","      sp500[i, ""ath""] <- 1"
"0","    }"
"0","  }"
"0",""
"0",""
"0","sp500_ath <- sp500 %>% filter(ath == 1) %>%"
"0","  mutate(days = date - lag(date))"
"0",""
"0","  # Find last lows"
"0","  for (i in 1:nrow(sp500)){"
"0","    if(sp500[i, ""adjusted""] > min(sp500[i:last(nrow(sp500)), ""adjusted""])){"
"0","      sp500[i, ""last_low""] <- 0"
"0","    } else{"
"0","      sp500[i, ""last_low""] <- 1"
"0","    }"
"0","  }"
"0",""
"0","sp500_lastlow <- sp500 %>% filter(last_low == 1 & ath == 1) %>%"
"0","  mutate(days = date - lag(date))"
